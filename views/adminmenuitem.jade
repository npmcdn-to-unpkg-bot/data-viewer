doctype html
html
  head
   link(rel="stylesheet", href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css")

   script(src="https://npmcdn.com/react@15.3.0/dist/react.js")
   script(src="https://npmcdn.com/react-dom@15.3.0/dist/react-dom.js")
   script(src="https://npmcdn.com/babel-core@5.8.38/browser.min.js")
   script(src="https://npmcdn.com/jquery@3.1.0/dist/jquery.min.js")
   script(src="https://npmcdn.com/remarkable@1.6.2/dist/remarkable.min.js")
   script(src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js")
   meta(charset="utf-8")
   meta(name="viewport" content="width=device-width, initial-scale=1")

  title Valikon otsikon ylläpito
  link(rel='stylesheet', href='/stylesheets/style.css')
  body
   div(id="content" class="container-floating")
   script(type="text/babel").
    // MENUITEM DATA
    var MenuItemData = React.createClass({displayName: 'MenuItemData',    
    
    showError : function(errorTextToAdd) {this.setState({errorText : errorTextToAdd});},

    showMessage : function(msg) {this.setState({messageText: msg});
        $(".messageText").show();
    },

    loadMenuItem : function(menuItemId) {
        $.ajax({
            url : '/menuItemService/item/' + menuItemId,
            dataType: 'json',
            cache: false,
            timeout: 15000,

            success: function(data) {
                this.setState({menuitemtext : data.text,
                               functions : data.functions })
            }.bind(this),

            error: function(xhr, status, err) {
                this.showError('Tietosisällön haku epäonnistui.');
            }.bind(this)
        });//ajax             
    }, // loadMenuItems

    getInitialState: function() {
        return {
            menuitemtext: '',
            functions : [],
            errorText : '',
            messageText : ''
            };
    },

    componentDidMount: function() {
        this.loadMenuItem(this.props.menuItemId);
    },

    handleTextChange : function(e) {
            this.setState( { menuitemtext : e.target.value});
    },

    saveBasicData : function(e) {
        $.ajax({
            url : '/menuItemService/item/' + this.props.menuItemId,
            type: "PUT",
            dataType: 'json',
            cache: false,
            timeout: 15000,
            data: {
                text: this.state.menuitemtext},

            success: function(data) {
                this.showMessage('Tiedot päivitetty.');
                this.loadMenuItem(this.props.menuItemId);
            }.bind(this),

            error: function(xhr, status, err) {
                this.showError('Päivitys epäonnistui.');
            }.bind(this)

        });//ajax
    },

    render : function() {
        return(
        <div>
            <div className="row">
                <div className="col-sm-12 systemName">
                    VALIKON OSAN MUOKKAUS 
                </div>
            </div>
            <div className="errorText">{this.state.errorText}</div>
            <div className="messageText">{this.state.messageText}</div>
            <form className="basicDataForm">
                <div className="row">
                    <div className="col-sm-12 dataTitle">
                    PERUSTIEDOT
                    </div>
                </div>
                <div className="row">
                    <div className="col-sm-3 dataHeader">
                    Teksti
                    </div>
                    <div className="col-sm-6 dataEdit">
                        <input
                                type="text"
                                className="inputField"
                                size="40"
                                placeholder="Teksti"
                                value={this.state.menuitemtext}
                                onChange={this.handleTextChange}
                                />
                    </div>
                </div>
                <div className="row">
                    <div className="col-sm-3 dataHeader invisibleBg">
                    &nbsp;
                    </div>
                    <div className="col-sm-6 dataEdit" >
                    <button id="savebasicdata" type="button" className="btn btn-primary btn-sm" onClick={this.saveBasicData}>Tallenna perustiedot</button>
                    </div>
                </div>
            </form>
        </div>
        )
    }
    });

    ReactDOM.render(
        <MenuItemData menuItemId='#{menuItemId}'/>, 
        document.getElementById('content'));

